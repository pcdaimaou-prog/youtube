name: "MC-AI-Architect-Ultimate-Form"
on:
  workflow_dispatch:
    inputs:
      mc_host:
        description: 'マイクラサーバーIP'
        default: '18s09924.aternos.me'
      # ペアごとの設定 (指示 | 座標1 | 座標2)
      p1_config:
        description: 'Pair1: 指示 | X1 Y1 Z1 | X2 Y2 Z2'
        default: 'モダンハウス | 100 64 100 | 120 80 120'
      p2_config:
        description: 'Pair2: 指示 | X1 Y1 Z1 | X2 Y2 Z2'
        default: '噴水広場 | 130 64 100 | 150 80 120'
      p3_config:
        description: 'Pair3: 指示 | X1 Y1 Z1 | X2 Y2 Z2'
        default: '見張り塔 | 160 64 100 | 180 80 120'
      p4_config:
        description: 'Pair4: 指示 | X1 Y1 Z1 | X2 Y2 Z2'
        default: 'TNT倉庫 | 190 64 100 | 210 80 120'
      p5_config:
        description: 'Pair5: 指示 | X1 Y1 Z1 | X2 Y2 Z2'
        default: '黄金の像 | 220 64 100 | 240 80 120'

permissions:
  contents: write

jobs:
  ai-bot:
    runs-on: ubuntu-latest
    strategy:
      fail-fast: false
      matrix:
        pair_id: [1, 2, 3, 4, 5]
        role: ["A", "B"]
    steps:
      - uses: actions/checkout@v4
      - name: Setup Ollama
        run: |
          curl -fsSL https://ollama.com/install.sh | sh
          ollama serve & sleep 10 && ollama pull llama3:8b-instruct-q4_0
      - name: Run Bot
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          npm install mineflayer minimist node-fetch@2
          # 選択されたペアの設定を取得
          FULL_CONFIG="${{ github.event.inputs[format('p{0}_config', matrix.pair_id)] }}"
          
          node main.js \
            --host "${{ github.event.inputs.mc_host }}" \
            --name "Bot-${{ matrix.pair_id }}-${{ matrix.role }}" \
            --pair "${{ matrix.pair_id }}" \
            --role "${{ matrix.role }}" \
            --config "$FULL_CONFIG"
